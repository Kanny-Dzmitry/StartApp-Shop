<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Shop</title>
    <link rel="stylesheet" href="/static/css/telegram-app.css">
    <link rel="stylesheet" href="/static/css/catalog.css">
    <link rel="stylesheet" href="/static/css/cart.css">
    <!-- Telegram WebApp JS SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <div id="error-message" class="message error-message"></div>
        <div id="success-message" class="message success-message"></div>
        
        <!-- –°–µ–∫—Ü–∏—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div id="home-container" class="home-container">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω!</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∏–∂–µ.</p>
            <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥–µ—Ä, –∞–∫—Ü–∏–∏, –Ω–æ–≤–∏–Ω–∫–∏ –∏ —Ç.–¥. -->
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile-container" class="profile-container" style="display: none;">
            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div id="auth-section" class="section" style="display: none;">
                <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram.</p>
                <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div id="profile-section" class="section" style="display: none;">
                <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                
                <!-- –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                <div id="view-mode">
                    <div class="profile-header">
                        <img id="profile-avatar" src="/static/img/default-avatar.png" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
                        <div class="profile-info">
                            <h3 class="profile-name" id="profile-name">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                            <p class="profile-username" id="profile-username">@username</p>
                        </div>
                        <button id="edit-profile-btn" class="edit-profile-icon" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                            <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19.4 7.34L16.66 4.6A2 2 0 0 0 14 4.53l-9 9a2 2 0 0 0-.57 1.21L4 18.91a1 1 0 0 0 .29.8A1 1 0 0 0 5 20h.09l4.17-.38a2 2 0 0 0 1.21-.57l9-9a1.92 1.92 0 0 0-.07-2.71zM9.08 17.62l-3 .28.27-3L12 9.32l2.7 2.7zM16 10l-2.68-2.68 1.55-1.55L17.58 8.4z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                <path d="M12 20H20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="user-info" class="user-info">
                        <!-- –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                    
                    <div id="addresses-container" class="addresses-container">
                        <h3>–ú–æ–∏ –∞–¥—Ä–µ—Å–∞ <span class="address-count" id="address-count">(0/5)</span></h3>
                        <div id="addresses-list" class="addresses-list">
                            <!-- –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                        <button id="add-address-btn" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                    </div>
                </div>
                
                <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                <div id="edit-mode" style="display: none;">
                    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                    
                    <form id="profile-edit-form">
                        <div class="form-group">
                            <label for="first-name">–ò–º—è</label>
                            <input type="text" id="first-name" name="first-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                        </div>
                        
                        <div class="form-group">
                            <label for="last-name">–§–∞–º–∏–ª–∏—è</label>
                            <input type="text" id="last-name" name="last-name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone-number">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="phone-number" name="phone-number" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" id="cancel-edit-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
                
                <!-- –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ -->
                <div id="address-edit-mode" style="display: none;">
                    <h3 id="address-form-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞</h3>
                    
                    <form id="address-edit-form">
                        <input type="hidden" id="address-id" name="address-id" value="">
                        
                        <div class="form-group">
                            <label for="address-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞</label>
                            <input type="text" id="address-name" name="address-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ–º, –†–∞–±–æ—Ç–∞">
                        </div>
                        
                        <div class="location-button-container">
                            <button type="button" id="get-location-btn" class="btn btn-secondary">
                                <span class="location-icon">üìç</span> –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–¥—Ä–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                                <span id="location-spinner" class="spinner" style="display: none;"></span>
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="district">–†–∞–π–æ–Ω</label>
                            <input type="text" id="district" name="district" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞–π–æ–Ω">
                        </div>
                        
                        <div class="form-group">
                            <label for="street">–£–ª–∏—Ü–∞</label>
                            <input type="text" id="street" name="street" placeholder="–í–≤–µ–¥–∏—Ç–µ —É–ª–∏—Ü—É">
                        </div>
                        
                        <div class="form-group">
                            <label for="house-number">–ù–æ–º–µ—Ä –¥–æ–º–∞</label>
                            <input type="text" id="house-number" name="house-number" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–º–∞">
                        </div>
                        
                        <div class="form-group">
                            <label for="floor">–≠—Ç–∞–∂</label>
                            <input type="text" id="floor" name="floor" placeholder="–í–≤–µ–¥–∏—Ç–µ —ç—Ç–∞–∂">
                        </div>
                        
                        <div class="form-group">
                            <label for="apartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
                            <input type="text" id="apartment" name="apartment" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã">
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" id="is-default" name="is-default">
                                <span class="checkmark"></span>
                                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∞–¥—Ä–µ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" id="cancel-address-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ -->
        <div id="catalog-container" class="catalog-container" style="display: none;">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É -->
            <div id="catalog-navigation" class="catalog-navigation" style="display: none;">
                <button id="back-to-categories">–ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                <button id="back-to-sections" style="display: none;">–ö —Ä–∞–∑–¥–µ–ª–∞–º</button>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ -->
            <div id="catalog-content" class="catalog-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã -->
        <div id="cart-container" class="cart-container" style="display: none;">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–æ—Ä–∑–∏–Ω—ã –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="bottom-nav">
            <div class="nav-button" data-tab="home">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="nav-button" data-tab="catalog">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 9h16M4 14h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="nav-button" data-tab="cart">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 22a1 1 0 100-2 1 1 0 000 2zM20 22a1 1 0 100-2 1 1 0 000 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="cart-badge" id="cart-badge">0</div>
            </div>
            <div class="nav-button" data-tab="profile">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="/static/js/telegram-auth.js"></script>
    <script src="/static/js/profile.js"></script>
    <script src="/static/js/cart.js"></script>
    <script src="/static/js/catalog.js"></script>
    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        document.addEventListener('DOMContentLoaded', () => {
            const navButtons = document.querySelectorAll('.nav-button');
            const containers = {
                'home': document.getElementById('home-container'),
                'profile': document.getElementById('profile-container'),
                'catalog': document.getElementById('catalog-container'),
                'cart': document.getElementById('cart-container')
            };
            
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é
            containers['home'].style.display = 'block';
            document.querySelector('.nav-button[data-tab="home"]').classList.add('active');
            
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    
                    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
                    navButtons.forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–∫—Ä—ã—Ç–∏—è
                    Object.values(containers).forEach(container => {
                        if (container.style.display === 'block') {
                            container.style.opacity = '0';
                            container.style.transform = 'translateY(10px)';
                        }
                    });
                    
                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        Object.keys(containers).forEach(key => {
                            if (key === tabName) {
                                containers[key].style.display = 'block';
                                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
                                setTimeout(() => {
                                    containers[key].style.opacity = '1';
                                    containers[key].style.transform = 'translateY(0)';
                                }, 10);
                            } else {
                                containers[key].style.display = 'none';
                            }
                        });
                    }, 200);
                });
            });
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                const user = window.Telegram.WebApp.initDataUnsafe.user;
                if (user.photo_url) {
                    document.getElementById('profile-avatar').src = user.photo_url;
                }
                if (user.first_name || user.last_name) {
                    document.getElementById('profile-name').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                }
                if (user.username) {
                    document.getElementById('profile-username').textContent = `@${user.username}`;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
            function updateCartBadge() {
                const cartBadge = document.getElementById('cart-badge');
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –∏–∑ localStorage
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const itemCount = cart.reduce((total, item) => total + item.quantity, 0);
                
                if (itemCount > 0) {
                    cartBadge.textContent = itemCount > 99 ? '99+' : itemCount;
                    cartBadge.classList.add('visible');
                } else {
                    cartBadge.textContent = '0';
                    cartBadge.classList.remove('visible');
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateCartBadge();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä–∑–∏–Ω–∞
            window.addEventListener('cart-updated', updateCartBadge);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.btn, .nav-button, .address-item').forEach(elem => {
                elem.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.98)';
                }, { passive: true });
                
                elem.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                }, { passive: true });
            });
        });
    </script>
</body>
</html> 